import { paintBoard } from '@/utils/paintBoard'
import { fabric } from 'fabric'

import { getDrawWidth } from '../common/draw'
import { useFreeDrawStore } from '@/store/modules/freeDraw'

const initPencil = () => {
  const canvas = paintBoard.canvas
  if (!canvas) return

  const pencilBrush = new fabric.PencilBrush(canvas)

  canvas.isDrawingMode = true

  canvas.freeDrawingBrush = pencilBrush

  // 修改笔触颜色
  canvas.freeDrawingBrush.color = useFreeDrawStore().drawColor

  // 修改笔触粗细
  canvas.freeDrawingBrush.width = getDrawWidth()

  // 阴影
  // canvas.freeDrawingBrush.shadow
}

const initCursor = () => {
  const canvas = paintBoard.canvas
  if (!canvas) return

  //游标大小
  const brushSize = getDrawWidth()
  //游标颜色
  // const brushColor = canvas.freeDrawingBrush.color

  //绘制游标为圆形的svg
  const circle = `
  <svg height="${brushSize}" viewBox="0 0 ${brushSize * 2} ${brushSize * 2}" width="${brushSize}" xmlns="http://www.w3.org/2000/svg">
      <style>
          circle {
              fill: white;
              stroke: white;
          }
      </style>
      <circle cx="${brushSize}" cy="${brushSize}" r="${brushSize}" />
  </svg>
  `

  // const cursorData = `data:image/svg+xml;utf8,${encodeURIComponent(circle)}`

  // const cursorData = `https://store-g1.seewo.com/enow-cloud_assets/68ed0e6474ec5e0c4c04e226e727d09f`

  const cursorData = `data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMzBweCIgaGVpZ2h0PSIzMHB4IiB2aWV3Qm94PSIwIDAgMzAgMzAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8dGl0bGU+aWNf55S756yUPC90aXRsZT4KICAgIDxnIGlkPSLpobXpnaItMSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9IjIyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTAxNS4wMDAwMDAsIC01NTEuMDAwMDAwKSIgZmlsbC1ydWxlPSJub256ZXJvIj4KICAgICAgICAgICAgPGcgaWQ9ImljX+eUu+eslCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAxNS4wMDAwMDAsIDU1MS4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxyZWN0IGlkPSLnn6nlvaIiIGZpbGw9IiM3MDcyNzUiIG9wYWNpdHk9IjAiIHg9IjAiIHk9IjAiIHdpZHRoPSIzMCIgaGVpZ2h0PSIzMCI+PC9yZWN0PgogICAgICAgICAgICAgICAgPHBhdGggZD0iTTQuOTM0Mjg3MzQsMTAuNDY3MTY4NCBDNS44ODYxMzg5MiwxMC40OTI5NjI2IDcuMzQwOTY2OTMsOS43ODExODEwNSA4LjUzOTkwNjI2LDguNTgyMjQxNzIgQzkuNzIxMTI0OTIsNy40MDEwMjMwNiAxMC40Mzk0MjI2LDUuOTk0MDMwNjcgMTAuNDM5NDIyNiw0Ljk1ODQ3NzY5IEMxMC40Mzk0MjI2LDQuNzI5OTI1MjggMTAuMzM2NDE4Myw0LjM0MzA2MDExIDEwLjIwMTk3Myw0LjA5MTc0NzgyIEwyNS42MDMzNiwxOS40OTMxMzQ4IEMyNi40Njk5OTE5LDIwLjM1OTc2NjcgMjUuNzk1MjM4MiwyMi40Mzk2MDgyIDI0LjA5NjI1NTQsMjQuMTM4NTkwOSBDMjIuMzk3MjcyNywyNS44Mzc1NzM2IDIwLjMxNzQzMTIsMjYuNTEyMzI3MyAxOS40NTA3OTk0LDI1LjY0NTY5NTUgTDQuMDQ5NDEyMzcsMTAuMjQ0MzA4NSBDNC40OTk3NDgzOCwxMC40NjcxNjg0IDQuNjgyMzEwMjcsMTAuNDY3MTY4NCA0LjkzNDI4NzM0LDEwLjQ2NzE2ODQgWiBNMi45NzQ0NTQwMyw5LjE2OTM1MDE1IEMyLjc3MDg1NTEyLDguOTY1NzUxMjUgMi42NDUzODgyNyw4LjcwMjEzMzE5IDIuNTk2NDY1MjMsOC4zOTQwNDgwMSBMMS4wNzUzMzM5NSwyLjYyNTc4MzQyIEMwLjkxNDgxNTIxLDIuMjE1NjY4NzEgMS4wMTIzMzcxMywxLjcxNjQxMjU3IDEuMzYwNTg3ODEsMS4zNjgxNjE4OSBDMS42NzY3ODExOSwxLjA1MTk2ODUxIDIuMTE3NDU4NzgsMC45NDI0NjgxMjEgMi41MDI4NzQ1MSwxLjA0NTEzMzU3IEw4LjMxMzAwNzk4LDIuNjI3MDk5MTYgQzguNjM2ODQ3NzcsMi42NzM5MzM1NCA4LjkxMzc5MjU3LDIuODAzNTY3MzcgOS4xMjcwMTQ2OSwzLjAxNjc4OTQ5IEM5LjI1MzY5ODg1LDMuMTQzNDczNjUgOS4zNTA4NzU5OCwzLjI5MjY1MjE5IDkuNDE4NzExNTIsMy40NjA3OTU3OCBDOS40ODY1NDcwNSwzLjYyODkzOTM2IDkuNDg2NTQ3MDUsMy42Mjg5MzkzNiA5LjUxMDE3MDE0LDMuODMzNzM2OTkgQzkuNTMzNzkzMjIsNC4wMzg1MzQ2MSA5LjUzOTM4OTQzLDQuMTE3OTMxOTMgOS41MzY1OTEzMiw0LjI5MjkzNDk4IEM5LjUzMzc5MzIyLDQuNDY3OTM4MDQgOS40ODk3MDgxLDQuNjQ0MjY4NiA5LjQyOTI3NTg4LDQuODU2ODIzMzUgQzkuMjE5NDc1MzcsNS42NTczOTA4IDguNTk5MjE1ODEsNi42ODI5Mzk4NyA3LjYzNzI5MDgsNy42NDQ4NjQ4OCBDNi42NTk2MTI1Miw4LjYyMjU0MzE1IDUuNjUwMzk5NDMsOS4yMzU5NzM1MiA0Ljc4ODk1NzMxLDkuNDY2ODQ0NDIgQzQuNjU0NjA5ODMsOS40OTc4NjA1MiA0LjExODk5NTgyLDkuNTk2NDMyMyAzLjg4Mjg4MTMyLDkuNTcwODQyOTQgQzMuNzI1NDcxNjUsOS41NTM3ODMzOCAzLjU3MTMzNTA2LDkuNTE2NTE0MzEgMy40MjA0NzE1Niw5LjQ1OTAzNTc0IEMzLjI1MTA1OTUzLDkuMzkyNDY4NjQgMy4xMDExMzgxOSw5LjI5NjAzNDMxIDIuOTc0NDU0MDMsOS4xNjkzNTAxNSBaIiBpZD0i5b2i54q2IiBmaWxsLW9wYWNpdHk9IjAuNiIgZmlsbD0iIzJCMkUzMyI+PC9wYXRoPgogICAgICAgICAgICAgICAgPHBhdGggZD0iTTIuMjY3MzQ3MjUsOS44Njg4MTczNSBDMS45MjQyMTY0Miw5LjUyNTY4NjUzIDEuNzA2NDI2NDgsOS4wODkzNjAzOCAxLjYxODE2MDQxLDguNTk4MzE2MDEgTDAuMTIwNzE1MjkyLDIuOTE5ODcxNDUgQy0wLjE1NTI0NDA5MiwyLjE0MjE2ODg1IDAuMDUwMDUxMjM4LDEuMjU2ODQ1MzEgMC42NTM0ODEwMjgsMC42NTM0MTU1MjMgQzEuMjEzMzAwMzMsMC4wOTM1OTYyMTg0IDIuMDE4NDczMDcsLTAuMTI2NDA4OTUgMi43NjAyNzQ3OSwwLjA3MTE4OTExNTMgTDguNTIzMjM0NTIsMS42NDAyOTQ4NCBDOS4wMzAwNTI3NiwxLjcyNjI3NjIgOS40ODA2Mzc0NCwxLjk0ODU1OTA5IDkuODM0MTIxNDcsMi4zMDIwNDMxMiBMMjYuMzEwNDY2OCwxOC43NzgzODg1IEMyNy42OTY4MjYzLDIwLjE2NDc0OCAyNi44NDIxMDU2LDIyLjc5OTMxNDcgMjQuODAzMzYyMiwyNC44MzgwNTgxIEMyMi43NjQ2MTg4LDI2Ljg3NjgwMTUgMjAuMTMwMDUyMSwyNy43MzE1MjIyIDE4Ljc0MzY5MjYsMjYuMzQ1MTYyNyBMMi4yNjczNDcyNSw5Ljg2ODgxNzM1IFogTTQuOTM0Mjg3MzQsMTAuNDU5NTI4OCBDNC42NjQxNjkzMSwxMC40NTk1Mjg4IDQuNDEyNjExNjEsMTAuNDE5MTA3NyA0LjA0OTQxMjM3LDEwLjIzNjY2ODkgTDE5LjQ1MDc5OTQsMjUuNjM4MDU1OSBDMjAuMzE3NDMxMiwyNi41MDQ2ODc3IDIyLjM5NzI3MjcsMjUuODI5OTM0IDI0LjA5NjI1NTQsMjQuMTMwOTUxMyBDMjUuNzk1MjM4MiwyMi40MzE5Njg2IDI2LjQ2OTk5MTksMjAuMzUyMTI3MSAyNS42MDMzNiwxOS40ODU0OTUyIEwxMC4yMDE5NzMsNC4wODQxMDgyNCBDMTAuMzM2NDE4Myw0LjMzNTQyMDUyIDEwLjQ2MjgxNDMsNC43NDU4MjEwMSAxMC40MzYyNjQsNS4wMzEwMzgzIEMxMC4zOTgyMzkxLDYuMDUyMzcwMDkgOS43MjExMjQ5Miw3LjM5MzM4MzQ3IDguNTM5OTA2MjYsOC41NzQ2MDIxNCBDNy4zNDA5NjY5Myw5Ljc3MzU0MTQ3IDUuOTUyMzY1NTEsMTAuNDYyNDI5OCA0LjkzNDI4NzM0LDEwLjQ1OTUyODggWiBNMi45NzQ0NTQwMyw5LjE2MTcxMDU3IEMzLjEwMTEzODE5LDkuMjg4Mzk0NzMgMy4yNTEwNTk1Myw5LjM4NDgyOTA1IDMuNDIwNDcxNTYsOS40NTEzOTYxNSBDMy41NzEzMzUwNiw5LjUwODg3NDcyIDMuNzI1NDcxNjUsOS41NDYxNDM3OSAzLjg4Mjg4MTMyLDkuNTYzMjAzMzYgQzQuMTE4OTk1ODIsOS41ODg3OTI3MSA0LjY1NDYwOTgzLDkuNDkwMjIwOTQgNC43ODg5NTczMSw5LjQ1OTIwNDg0IEM1LjY1MDM5OTQzLDkuMjI4MzMzOTQgNi42NTk2MTI1Miw4LjYxNDkwMzU2IDcuNjM3MjkwOCw3LjYzNzIyNTI5IEM4LjU5OTIxNTgxLDYuNjc1MzAwMjggOS4yMTk0NzUzNyw1LjY0OTc1MTIyIDkuNDI5Mjc1ODgsNC44NDkxODM3NyBDOS40ODk3MDgxLDQuNjM2NjI5MDIgOS41MzM3OTMyMiw0LjQ2MDI5ODQ1IDkuNTM2NTkxMzIsNC4yODUyOTU0IEM5LjUzOTM4OTQzLDQuMTEwMjkyMzUgOS41MzM3OTMyMiw0LjAzMDg5NTAyIDkuNTEwMTcwMTQsMy44MjYwOTc0IEM5LjQ4NjU0NzA1LDMuNjIxMjk5NzggOS40ODY1NDcwNSwzLjYyMTI5OTc4IDkuNDE4NzExNTIsMy40NTMxNTYxOSBDOS4zNTA4NzU5OCwzLjI4NTAxMjYxIDkuMjUzNjk4ODUsMy4xMzU4MzQwNiA5LjEyNzAxNDY5LDMuMDA5MTQ5OSBDOC45MTM3OTI1NywyLjc5NTkyNzc4IDguNjM2ODQ3NzcsMi42NjYyOTM5NSA4LjMxMzAwNzk4LDIuNjE5NDU5NTcgTDIuNTAyODc0NTEsMS4wMzc0OTM5OCBDMi4xMTc0NTg3OCwwLjkzNDgyODUzNyAxLjY3Njc4MTE5LDEuMDQ0MzI4OTIgMS4zNjA1ODc4MSwxLjM2MDUyMjMgQzEuMDEyMzM3MTMsMS43MDg3NzI5OCAwLjkxNDgxNTIxLDIuMjA4MDI5MTIgMS4wNzUzMzM5NSwyLjYxODE0Mzg0IEwyLjU5NjQ2NTIzLDguMzg2NDA4NDIgQzIuNjQ1Mzg4MjcsOC42OTQ0OTM2MSAyLjc3MDg1NTEyLDguOTU4MTExNjYgMi45NzQ0NTQwMyw5LjE2MTcxMDU3IFoiIGlkPSLlvaLnirYiIGZpbGwtb3BhY2l0eT0iMC40IiBmaWxsPSIjRkZGRkZGIj48L3BhdGg+CiAgICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg==`

  //设置游标数据,其中crosshair为加载失败的情况下的默认游标。
  canvas.freeDrawingCursor = `url(${cursorData}) ${brushSize / 2} ${brushSize / 2}, crosshair`
}

// 画笔
export const renderPencilBrush = () => {
  initPencil()
  initCursor()
}
